pipeline {
    agent {
        node {
            label 'maven-server'
        }
    }
    tools {
        maven "mvn"
    }
    stages {
        stage('Git clone') {
            steps {
                git credentialsId: 'github-jenkins', url: "${Repo}"
            }
        }
        stage('Build') {
            steps {
                sh "/opt/apache-maven-3.8.6/bin/mvn clean install"
            }
        }
        stage('Sonar') {
            steps {
                withSonarQubeEnv(credentialsId: 'sonarqube') {
                    sh 'mvn sonar:sonar -Dsonar.projectName=test -Dsonar.projectKey=test'
                }
            }
        }
        stage('Uploading to JFrog Artifactory') {
            steps {
                rtUpload (
                    serverId: 'jfrog',
                    spec: '''{
                        "files": [{
                            "pattern": "module-a/target/*.jar",
                            "target": "jfrog-repository/"
                        }]
                    }'''
                )
            }
        }
        stage('Archiving the Artifact') {
            steps {
                archiveArtifacts artifacts: 'module-a/target/*.jar', followSymlinks: false
            }
        }
    }
}
